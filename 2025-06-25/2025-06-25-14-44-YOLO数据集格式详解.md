# YOLO 数据集格式完全指南 - 从零构建标准数据集

## 📁 数据集目录结构要求

### 标准目录结构
```
dataset/                    # 数据集根目录（名称可自定义）
├── images/                 # 图片文件夹（名称固定）
│   ├── train/             # 训练集图片（名称固定）
│   │   ├── img1.jpg       # 图片文件
│   │   ├── img2.jpg       # 图片文件
│   │   └── ...
│   └── val/               # 验证集图片（名称固定）
│       ├── img3.jpg       # 图片文件
│       ├── img4.jpg       # 图片文件
│       └── ...
└── labels/                # 标签文件夹（名称固定）
    ├── train/             # 训练集标签（名称固定）
    │   ├── img1.txt       # 对应img1.jpg的标签
    │   ├── img2.txt       # 对应img2.jpg的标签
    │   └── ...
    └── val/               # 验证集标签（名称固定）
        ├── img3.txt       # 对应img3.jpg的标签
        ├── img4.txt       # 对应img4.jpg的标签
        └── ...
```

### 🔍 关键要求说明

#### 1. 目录名称要求
- ✅ **必须严格按照**: `images/` 和 `labels/`
- ✅ **子目录必须**: `train/` 和 `val/`
- ✅ **可选添加**: `test/` 目录
- ❌ **不能修改**: 这些目录名是YOLO的标准

#### 2. 文件对应关系
- **一一对应**: 每个图片文件必须有对应的标签文件
- **文件名相同**: `img1.jpg` ↔ `img1.txt`
- **扩展名不同**: 图片用图片格式，标签用 `.txt`

---

## 🖼️ 图片文件要求

### 支持的图片格式
```python
支持格式: .jpg, .jpeg, .png, .bmp, .tiff, .dng, .webp, .mpo
推荐格式: .jpg 或 .png
```

### 图片质量要求
```
分辨率: 建议 ≥ 640×640 像素
宽高比: 任意比例（YOLO会自动调整）
颜色: RGB彩色图片（灰度图也可以）
大小: 建议 < 10MB 每张
数量: 训练集建议 ≥ 1000张，验证集约20%
```

### 图片命名规范
```
✅ 好的命名:
- person_001.jpg
- cat_running_01.png  
- traffic_scene_123.jpg

❌ 避免的命名:
- 图片1.jpg (中文名)
- img with spaces.jpg (空格)
- img@#$.jpg (特殊字符)
```

---

## 📝 标签文件格式详解

### 标签文件内容格式
```
# 每行一个物体，格式：
class_id x_center y_center width height

# 示例内容：
0 0.5 0.5 0.3 0.4
1 0.2 0.3 0.1 0.2
0 0.8 0.7 0.15 0.25
```

### 🔢 各字段详细说明

#### 1. class_id（类别ID）
```python
类别ID: 从0开始的整数
0 = 第一个类别（如：person）
1 = 第二个类别（如：car）  
2 = 第三个类别（如：dog）
...

# 必须连续，不能跳跃
✅ 正确: 0, 1, 2, 3
❌ 错误: 0, 2, 5, 8
```

#### 2. 坐标系统（归一化坐标）
```python
# 所有坐标都是相对于图片大小的比例
x_center: 中心点X坐标 / 图片宽度  (0.0 - 1.0)
y_center: 中心点Y坐标 / 图片高度  (0.0 - 1.0)  
width:    目标宽度 / 图片宽度      (0.0 - 1.0)
height:   目标高度 / 图片高度      (0.0 - 1.0)

# 坐标系原点在左上角
(0,0) -----> X轴
  |
  |
  ↓
 Y轴
```

### 📐 坐标转换示例

假设图片尺寸：800×600 像素，目标框：左上角(100,50)，右下角(300,250)

```python
# 1. 计算中心点和尺寸（像素坐标）
center_x = (100 + 300) / 2 = 200
center_y = (50 + 250) / 2 = 150  
box_width = 300 - 100 = 200
box_height = 250 - 50 = 200

# 2. 归一化（转换为0-1范围）
x_center = 200 / 800 = 0.25
y_center = 150 / 600 = 0.25
width = 200 / 800 = 0.25  
height = 200 / 600 = 0.333

# 3. 标签文件内容
0 0.25 0.25 0.25 0.333
```

---

## ⚙️ 配置文件要求

### 创建 data.yaml 文件
```yaml
# 数据集路径（相对于配置文件的路径）
path: ./dataset           # 数据集根目录
train: images/train       # 训练集图片路径
val: images/val          # 验证集图片路径

# 类别数量
nc: 3                    # 类别总数

# 类别名称（按ID顺序）
names:
  0: person             # class_id 0 对应 person
  1: car                # class_id 1 对应 car  
  2: dog                # class_id 2 对应 dog
```

### 配置文件详细说明
```yaml
# 路径配置
path: ./dataset          # 可以是相对路径或绝对路径
train: images/train      # 相对于path的路径
val: images/val         # 相对于path的路径
test: images/test       # 可选，测试集路径

# 类别配置  
nc: 类别数量             # 必须等于实际类别数
names: 类别名称列表       # 数组格式或字典格式都可以

# 示例1：数组格式
names: ['person', 'car', 'dog']

# 示例2：字典格式  
names:
  0: person
  1: car
  2: dog
```

---

## 🛠️ 数据集制作工具和流程

### 1. 图片标注工具

#### LabelImg（推荐）
```bash
# 安装
pip install labelImg

# 运行
labelImg

# 使用步骤：
1. 打开图片文件夹
2. 选择保存格式为 YOLO
3. 设置类别文件（classes.txt）
4. 开始标注矩形框
5. 自动保存为.txt格式
```

#### 其他标注工具
- **LabelMe**: 支持多种格式，需要转换
- **Roboflow**: 在线标注平台
- **CVAT**: 企业级标注工具
- **Makesense.ai**: 免费在线工具

### 2. 创建类别文件 classes.txt
```
# classes.txt 内容示例
person
car
dog
cat
bicycle
```

### 3. 自动化脚本示例

#### 批量检查数据集
```python
import os
import glob

def check_dataset(dataset_path):
    """检查数据集完整性"""
    
    # 检查目录结构
    required_dirs = [
        'images/train', 'images/val',
        'labels/train', 'labels/val'
    ]
    
    for dir_path in required_dirs:
        full_path = os.path.join(dataset_path, dir_path)
        if not os.path.exists(full_path):
            print(f"❌ 缺少目录: {dir_path}")
            return False
        print(f"✅ 目录存在: {dir_path}")
    
    # 检查文件对应关系
    for split in ['train', 'val']:
        img_dir = os.path.join(dataset_path, 'images', split)
        label_dir = os.path.join(dataset_path, 'labels', split)
        
        # 获取所有图片文件
        img_files = glob.glob(os.path.join(img_dir, '*.*'))
        img_names = [os.path.splitext(os.path.basename(f))[0] for f in img_files]
        
        # 检查每个图片是否有对应标签
        missing_labels = []
        for img_name in img_names:
            label_file = os.path.join(label_dir, f"{img_name}.txt")
            if not os.path.exists(label_file):
                missing_labels.append(img_name)
        
        if missing_labels:
            print(f"❌ {split}集缺少标签文件: {missing_labels}")
        else:
            print(f"✅ {split}集文件对应关系正确")
    
    return True

# 使用示例
check_dataset('./dataset')
```

#### 标签格式验证
```python
def validate_label_file(label_path, num_classes):
    """验证标签文件格式"""
    try:
        with open(label_path, 'r') as f:
            lines = f.readlines()
        
        for line_num, line in enumerate(lines, 1):
            line = line.strip()
            if not line:  # 跳过空行
                continue
                
            parts = line.split()
            if len(parts) != 5:
                print(f"❌ {label_path}:{line_num} 格式错误，应该有5个数字")
                return False
            
            try:
                class_id, x, y, w, h = map(float, parts)
            except ValueError:
                print(f"❌ {label_path}:{line_num} 包含非数字内容")
                return False
            
            # 检查class_id
            if not (0 <= class_id < num_classes):
                print(f"❌ {label_path}:{line_num} class_id={class_id} 超出范围[0,{num_classes-1}]")
                return False
            
            # 检查坐标范围
            if not (0 <= x <= 1 and 0 <= y <= 1 and 0 <= w <= 1 and 0 <= h <= 1):
                print(f"❌ {label_path}:{line_num} 坐标超出[0,1]范围")
                return False
        
        print(f"✅ {label_path} 格式正确")
        return True
        
    except Exception as e:
        print(f"❌ 读取{label_path}失败: {e}")
        return False

# 批量验证
def validate_all_labels(dataset_path, num_classes):
    """验证所有标签文件"""
    for split in ['train', 'val']:
        label_dir = os.path.join(dataset_path, 'labels', split)
        label_files = glob.glob(os.path.join(label_dir, '*.txt'))
        
        print(f"\n验证 {split} 集标签文件:")
        valid_count = 0
        for label_file in label_files:
            if validate_label_file(label_file, num_classes):
                valid_count += 1
        
        print(f"✅ {split}集: {valid_count}/{len(label_files)} 个文件有效")

# 使用示例
validate_all_labels('./dataset', num_classes=3)
```

---

## 📊 数据集质量要求

### 1. 数据量建议
```
最小数据量（可训练）:
- 每个类别: ≥ 100张图片
- 训练集: ≥ 500张图片
- 验证集: 训练集的20-30%

理想数据量（效果好）:
- 每个类别: ≥ 1000张图片  
- 训练集: ≥ 5000张图片
- 验证集: 训练集的20%
```

### 2. 数据质量要求
```
图片质量:
✅ 清晰度高，无模糊
✅ 光照条件多样化
✅ 背景环境多样化
✅ 目标大小多样化
✅ 角度和姿态多样化

标注质量:
✅ 边界框紧贴目标
✅ 不遗漏小目标
✅ 类别标注准确
✅ 一致性好
```

### 3. 数据分布建议
```python
训练集/验证集分割:
- 训练集: 80%
- 验证集: 20%  
- 测试集: 可选，额外准备

类别平衡:
- 尽量保持各类别数量平衡
- 避免某类别过多或过少
- 如有不平衡，考虑数据增强
```

---

## 🔧 常见问题和解决方案

### 问题1: 坐标转换错误
```python
# 错误示例：直接使用像素坐标
❌ 错误: 0 100 50 200 150

# 正确示例：使用归一化坐标  
✅ 正确: 0 0.25 0.25 0.25 0.33
```

### 问题2: 文件名不匹配
```
❌ 错误:
images/train/photo1.jpg
labels/train/img1.txt    # 文件名不对应

✅ 正确:
images/train/photo1.jpg  
labels/train/photo1.txt  # 文件名对应
```

### 问题3: 目录结构错误
```
❌ 错误结构:
dataset/
├── train_images/      # 目录名错误
├── train_labels/      # 目录名错误
└── config.yaml

✅ 正确结构:  
dataset/
├── images/
│   └── train/
├── labels/
│   └── train/
└── data.yaml
```

### 问题4: 类别ID不连续
```yaml
❌ 错误配置:
nc: 3
names:
  0: person
  2: car      # 跳过了1
  5: dog      # 跳过了3,4

✅ 正确配置:
nc: 3  
names:
  0: person
  1: car      # 连续
  2: dog      # 连续
```

---

## 📋 完整示例

### 示例数据集结构
```
my_custom_dataset/
├── images/
│   ├── train/
│   │   ├── person_001.jpg
│   │   ├── person_002.jpg  
│   │   ├── car_001.jpg
│   │   └── dog_001.jpg
│   └── val/
│       ├── person_003.jpg
│       ├── car_002.jpg
│       └── dog_002.jpg
├── labels/
│   ├── train/
│   │   ├── person_001.txt
│   │   ├── person_002.txt
│   │   ├── car_001.txt
│   │   └── dog_001.txt
│   └── val/
│       ├── person_003.txt
│       ├── car_002.txt
│       └── dog_002.txt
└── data.yaml
```

### 示例标签文件内容
```
# person_001.txt
0 0.5 0.4 0.3 0.6

# car_001.txt  
1 0.3 0.7 0.4 0.2
1 0.8 0.6 0.15 0.25

# dog_001.txt
2 0.6 0.5 0.2 0.3
```

### 示例配置文件
```yaml
# data.yaml
path: ./my_custom_dataset
train: images/train  
val: images/val

nc: 3

names:
  0: person
  1: car
  2: dog
```

---

## 🚀 数据集制作完整流程

### 第1步：收集图片
1. 拍摄或下载相关图片
2. 整理到 `images/train/` 和 `images/val/` 目录
3. 检查图片质量和格式

### 第2步：安装标注工具
```bash
pip install labelImg
```

### 第3步：创建类别文件
```bash
# 创建 classes.txt
echo -e "person\ncar\ndog" > classes.txt
```

### 第4步：开始标注
1. 打开 LabelImg
2. 设置图片目录和保存目录  
3. 加载类别文件
4. 逐张标注并保存

### 第5步：创建配置文件
```yaml
# data.yaml
path: ./dataset
train: images/train
val: images/val  
nc: 3
names: ['person', 'car', 'dog']
```

### 第6步：验证数据集
```python
# 运行验证脚本
check_dataset('./dataset')
validate_all_labels('./dataset', 3)
```

### 第7步：开始训练
```python
from ultralytics import YOLO

model = YOLO('yolov8n.pt')
model.train(data='data.yaml', epochs=100)
```

---

## 📝 数据集检查清单

在开始训练前，确保：

- [ ] 目录结构符合YOLO标准
- [ ] 每张图片都有对应的标签文件
- [ ] 标签文件格式正确（5个数字每行）
- [ ] 坐标都在[0,1]范围内
- [ ] 类别ID连续且从0开始
- [ ] 配置文件路径正确
- [ ] 类别数量匹配
- [ ] 数据量足够（建议每类≥100张）

**完成这些检查后，你的数据集就可以用来训练YOLO模型了！** 🎉

---

*文档创建时间：2025-06-25*  
*适用于：YOLO v8 数据集制作* 