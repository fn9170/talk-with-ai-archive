# é›·è¾¾å›¾ç‰‡åˆ†å‰²ä»£ç é€è¡Œè§£è¯»

## ğŸ¯ é—®é¢˜èƒŒæ™¯

**ç”¨æˆ·éœ€æ±‚ï¼š** å¤„ç†8000Ã—640çš„é•¿æ¡é›·è¾¾å›¾ç‰‡ï¼Œåˆ†å‰²æˆ640Ã—640çš„æ–¹å½¢å›¾ç‰‡ç”¨äºYOLOæ£€æµ‹ï¼Œé¿å…ç›®æ ‡è¢«åˆ†å‰²çº¿åˆ‡æ–­ã€‚

**æ ¸å¿ƒæŒ‘æˆ˜ï¼š** å¦‚ä½•åœ¨åˆ†å‰²è¿‡ç¨‹ä¸­ç¡®ä¿ä»»ä½•ä½ç½®çš„ç›®æ ‡éƒ½ä¸ä¼šè¢«åˆ†å‰²çº¿åˆ‡æ–­ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼š** ä½¿ç”¨é‡å åˆ†å‰²æ³•ï¼Œ30%é‡å ç¡®ä¿æ¯ä¸ªç›®æ ‡è‡³å°‘åœ¨ä¸€ä¸ªå®Œæ•´çª—å£ä¸­å‡ºç°ã€‚

---

## ğŸ“ å®Œæ•´ä»£ç é€è¡Œè§£è¯»

### ğŸ”§ **ç¬¬1-6è¡Œï¼šå¯¼å…¥ä¾èµ–åº“**
```python
# radar_image_splitter.py - é›·è¾¾å›¾ç‰‡åˆ†å‰²å™¨
import cv2                    # OpenCV - å›¾åƒå¤„ç†æ ¸å¿ƒåº“
import numpy as np            # NumPy - æ•°å€¼è®¡ç®—å’Œæ•°ç»„æ“ä½œ
import os                     # æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆæ–‡ä»¶è·¯å¾„ç­‰ï¼‰
from pathlib import Path      # ç°ä»£åŒ–çš„è·¯å¾„æ“ä½œï¼ˆæ¨èç”¨æ³•ï¼‰
import json                   # JSONæ•°æ®æ ¼å¼å¤„ç†ï¼ˆä¿å­˜åˆ†å‰²ä¿¡æ¯ï¼‰
```

**ğŸ’¡ åº“åŠŸèƒ½è¯¦è§£ï¼š**
- **cv2**: è¯»å–å›¾ç‰‡`cv2.imread()`ã€ä¿å­˜å›¾ç‰‡`cv2.imwrite()`ã€å›¾åƒå¤„ç†
- **numpy**: å¤„ç†å›¾åƒæ•°ç»„ï¼ˆå›¾ç‰‡æœ¬è´¨æ˜¯æ•°å­—çŸ©é˜µï¼‰ã€æ•°å­¦è¿ç®—
- **pathlib.Path**: æ¯”`os.path`æ›´ä¼˜é›…çš„æ–‡ä»¶è·¯å¾„æ“ä½œ
- **json**: ä¿å­˜åˆ†å‰²å…ƒä¿¡æ¯ï¼Œä¾›åç»­åæ ‡è½¬æ¢ä½¿ç”¨

### ğŸ—ï¸ **ç¬¬8-24è¡Œï¼šç±»åˆå§‹åŒ–ä¸æ ¸å¿ƒå‚æ•°**
```python
class RadarImageSplitter:
    def __init__(self, target_size=640, overlap_ratio=0.3):
        self.target_size = target_size        # ä¿å­˜ç›®æ ‡å°ºå¯¸ï¼š640
        self.overlap_ratio = overlap_ratio    # ä¿å­˜é‡å æ¯”ä¾‹ï¼š0.3
        self.stride = int(target_size * (1 - overlap_ratio))  # ğŸ”‘ æ ¸å¿ƒè®¡ç®—ï¼
```

**ğŸ”¥ æ ¸å¿ƒæ•°å­¦å…¬å¼è§£æï¼š**
```
stride = target_size Ã— (1 - overlap_ratio)
stride = 640 Ã— (1 - 0.3) = 640 Ã— 0.7 = 448

æ„ä¹‰è§£é‡Šï¼š
- target_size = 640ï¼šæ¯ä¸ªå­å›¾æ˜¯640Ã—640åƒç´ 
- overlap_ratio = 0.3ï¼šç›¸é‚»å­å›¾é‡å 30%
- stride = 448ï¼šæ¯æ¬¡å‘å³ç§»åŠ¨448åƒç´ 
- é‡å åƒç´  = 640 - 448 = 192åƒç´  = 30%
```

**ğŸ“Š é‡å åŸç†å›¾è§£ï¼š**
```
åŸå›¾ï¼š|----------8000åƒç´ ----------|
å­å›¾1ï¼š|----640----|
å­å›¾2ï¼š     |----640----|  (é‡å 192px)
å­å›¾3ï¼š          |----640----|  (é‡å 192px)
ç§»åŠ¨ï¼š    448      448      448
```

### ğŸ”„ **ç¬¬62-67è¡Œï¼šæ ¸å¿ƒåˆ†å‰²å¾ªç¯é€»è¾‘**
```python
    # æ¨ªå‘åˆ†å‰²ï¼ˆxæ–¹å‘ï¼‰
    x = 0                     # èµ·å§‹xåæ ‡ï¼šä»æœ€å·¦è¾¹å¼€å§‹
    while x < width:          # å¾ªç¯æ¡ä»¶ï¼šx < 8000
        # ğŸš¨ è¾¹ç•Œå¤„ç†ï¼šç¡®ä¿ä¸è¶…å‡ºå³è¾¹ç•Œ
        if x + self.target_size > width:           # å¦‚æœ x + 640 > 8000
            x = max(0, width - self.target_size)   # è°ƒæ•´ä¸º max(0, 8000-640) = 7360
```

**ğŸ¯ è¾¹ç•Œå¤„ç†ç®—æ³•è¯¦è§£ï¼š**
```
æ­£å¸¸åˆ†å‰²åºåˆ—ï¼š
x = 0:    [0, 640]     âœ…
x = 448:  [448, 1088]  âœ…  
x = 896:  [896, 1536]  âœ…
...
x = 7168: [7168, 7808] âœ…

è¾¹ç•Œæƒ…å†µï¼š
x = 7616: [7616, 8256] âŒ è¶…å‡ºè¾¹ç•Œï¼
è‡ªåŠ¨è°ƒæ•´ï¼š
x = 7360: [7360, 8000] âœ… å®Œç¾è´´åˆå³è¾¹ç•Œ
```

### âœ‚ï¸ **ç¬¬76-89è¡Œï¼šå›¾åƒè£å‰ªä¸å¡«å……æ ¸å¿ƒç®—æ³•**
```python
        # æå–å­å›¾
        if height >= self.target_size:
            sub_image = image[y:y+self.target_size, x:x+self.target_size]
        else:
            sub_image = image[y:height, x:x+self.target_size]
            padding = self.target_size - height
            sub_image = cv2.copyMakeBorder(
                sub_image, 0, padding, 0, 0,              # top, bottom, left, right
                cv2.BORDER_CONSTANT, value=[0, 0, 0]      # é»‘è‰²å¡«å……
            )
```

**ğŸ” NumPyæ•°ç»„åˆ‡ç‰‡è¯¦è§£ï¼š**
```python
image[y:y+640, x:x+640]  # äºŒç»´æ•°ç»„åˆ‡ç‰‡è¯­æ³•
# ä»ä½ç½®(448, 0)æå–640Ã—640åŒºåŸŸ
sub_image = image[0:640, 448:1088]
```

### ğŸ’¾ **ç¬¬91-105è¡Œï¼šæ–‡ä»¶ä¿å­˜ä¸ä¿¡æ¯è®°å½•**
```python
        # ä¿å­˜å­å›¾
        split_filename = f"{base_name}_split_{split_count:03d}.jpg"
        split_path = output_path / split_filename
        cv2.imwrite(str(split_path), sub_image)
        
        # è®°å½•åˆ†å‰²ä¿¡æ¯
        split_info["splits"].append({
            "filename": split_filename,                    # å­å›¾æ–‡ä»¶å
            "position": [x, y],                           # åœ¨åŸå›¾ä¸­çš„ä½ç½®åæ ‡
            "size": [self.target_size, self.target_size]  # å­å›¾å°ºå¯¸ [640, 640]
        })
```

**ğŸ“ æ–‡ä»¶å‘½åè§„åˆ™è¯¦è§£ï¼š**
```python
f"{base_name}_split_{split_count:03d}.jpg"
# ç»“æœï¼šradar_8000x640_split_005.jpg
# {:03d} è¡¨ç¤º3ä½æ•°å­—ï¼Œä¸è¶³è¡¥0
```

### ğŸ¯ **æ¼”ç¤ºå›¾ç‰‡ç”Ÿæˆçš„æ™ºæ…§è®¾è®¡**
```python
    # ğŸ¯ å…³é”®ï¼šæ•…æ„è®¾è®¡è·¨è¶Šåˆ†å‰²çº¿çš„ç›®æ ‡
    targets = [
        (3200, height//2-25, 50, 50),    # ğŸ”¥ ä¸­é—´ç›®æ ‡ï¼ˆè·¨è¶Šåˆ†å‰²çº¿ï¼ï¼‰
    ]
```

**ğŸ¯ ç›®æ ‡ä½ç½®è®¾è®¡çš„æ™ºæ…§ï¼š**
```
åˆ†å‰²ä½ç½®åˆ†æï¼š
å­å›¾7: x=2688, èŒƒå›´[2688, 3328]  â† åŒ…å«ç›®æ ‡3200
å­å›¾8: x=3136, èŒƒå›´[3136, 3776]  â† ä¹ŸåŒ…å«ç›®æ ‡3200

ç›®æ ‡ä½ç½®3200å¤„çš„50Ã—50ç›®æ ‡ï¼š
- åœ¨å­å›¾7ä¸­ï¼šå®Œæ•´å‡ºç° âœ…
- åœ¨å­å›¾8ä¸­ï¼šä¹Ÿå®Œæ•´å‡ºç° âœ…
- é‡å è®¾è®¡ç¡®ä¿ç›®æ ‡ä¸ä¼šè¢«åˆ‡æ–­ï¼
```

## ğŸ§® æ ¸å¿ƒç®—æ³•æ•°å­¦åŸç†

### ğŸ“Š **é‡å åˆ†å‰²å…¬å¼æ¨å¯¼**
```python
# ç»™å®šå‚æ•°
W = 8000          # åŸå›¾å®½åº¦
T = 640           # ç›®æ ‡åˆ†å‰²å°ºå¯¸
r = 0.3           # é‡å æ¯”ä¾‹

# æ ¸å¿ƒè®¡ç®—
stride = T Ã— (1 - r) = 640 Ã— 0.7 = 448
overlap = T - stride = 640 - 448 = 192

# å­å›¾æ•°é‡ï¼š18ä¸ª
# è¦†ç›–ç‡ï¼š1.44å€ï¼ˆ44%å†—ä½™ç”¨äºé‡å ï¼‰
```

### ğŸ¯ **ç›®æ ‡ä¿æŠ¤åŸç†**
å¯¹äºä»»æ„ä½ç½®çš„ç›®æ ‡ï¼Œé‡å è®¾è®¡ç¡®ä¿ï¼š
- stride < Tï¼ˆ448 < 640ï¼‰
- ç›¸é‚»å­å›¾æœ‰é‡å 
- ä»»æ„ç›®æ ‡è‡³å°‘åœ¨ä¸€ä¸ªå­å›¾ä¸­å®Œæ•´å‡ºç°

## ğŸ¯ ç®—æ³•ç‰¹ç‚¹æ€»ç»“

### âœ… **æ ¸å¿ƒä¼˜åŠ¿**
1. **é›¶ç›®æ ‡ä¸¢å¤±**: 30%é‡å ç¡®ä¿ä»»ä½•ä½ç½®çš„ç›®æ ‡éƒ½ä¸ä¼šè¢«åˆ‡æ–­
2. **é«˜æ•ˆå¤„ç†**: åˆ†å‰²åå¯å¹¶è¡Œè¿›è¡ŒYOLOæ£€æµ‹
3. **åæ ‡æ˜ å°„**: å®Œæ•´çš„ä½ç½®ä¿¡æ¯æ”¯æŒç»“æœåˆå¹¶
4. **è¾¹ç•Œä¼˜åŒ–**: æ™ºèƒ½è¾¹ç•Œå¤„ç†ç¡®ä¿å®Œæ•´è¦†ç›–
5. **å¯é…ç½®æ€§**: é‡å æ¯”ä¾‹å¯æ ¹æ®ç›®æ ‡å¤§å°è°ƒæ•´

è¿™ä¸ªåˆ†å‰²å™¨ä¸ä»…è§£å†³äº†ä½ çš„å…·ä½“éœ€æ±‚ï¼Œæ›´æä¾›äº†ä¸€ä¸ªé€šç”¨çš„é‡å åˆ†å‰²è§£å†³æ–¹æ¡ˆï¼